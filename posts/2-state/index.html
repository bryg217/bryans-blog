<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How To Manage Global State Without Redux</title>
    <meta name="description" content="Checkout a cool technique for handling data that is shared between pages.">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Bryan&#39;s Blog">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Bryan&#39;s Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Bryan&#39;s Blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/about/">About</a></li>
      </ul>
    </header>

    <main class="tmpl-post">
      <h1>How To Manage Global State Without Redux</h1>

<time datetime="2021-10-18">18 Oct 2021</time><a href="/tags/hard-skills/" class="post-tag">Hard Skills</a><a href="/tags/react/" class="post-tag">React</a>

<h2 id="description" tabindex="-1">Description <a class="direct-link" href="#description" aria-hidden="true">#</a></h2>
<p>In this post, I'd like to share a technique for managing state within React, specifically,<br>
<strong>state shared between different pages.</strong>  This is, especially, a nice technique for those of you who are using <code>Next.js</code>.</p>
<p>It's important to emphasize that last point above: <strong>state shared between different pages</strong>.</p>
<p>Within <code>React</code>, you of course have many different options when it comes to state.  There are different patterns and APIs for different problems.  As an example, it's perfectly okay to use the standard <code>useState</code> API for certain use cases.  One that comes to mind is where you have a &quot;page&quot; component (e.g. <code>Home</code>), and that component has a state variable for a banner (i.e. a sub-component that can hide or show based on conditions).  For this imaginary use case, it's okay for that piece of state to live within <code>Home</code>, since no other page cares about it.  This is important to keep in mind.</p>
<p>With this post, and many other to come, I don't seek to take an opinionated stance.  I believe there's many different approaches for many different problems.  Instead, I just seek to add another tool to our metaphorical tool belt.</p>
<p>So, again, this post simply shows <strong>a different way of sharing state between different pages/routes within a React app, without Redux -- again, especially for developers using Next.js</strong>.</p>
<p><strong>Note:</strong> At the end of this post, I'll share a link to an example project using this approach.</p>
<p><strong>Note:</strong> I learned this pattern from an amazing YouTube and YouTuber.  <a href="https://www.youtube.com/watch?v=MR43-gYVQbI&amp;t=504s">Here</a> is the link to that video (thank him for me).</p>
<h2 id="prerequisites" tabindex="-1">Prerequisites <a class="direct-link" href="#prerequisites" aria-hidden="true">#</a></h2>
<p>Familiarity with the points below is needed before moving forward:</p>
<ol>
<li>React</li>
<li>React Context</li>
</ol>
<p>Nice to haves:</p>
<ol>
<li>Redux Concepts (i.e. reducers, actions, dispatchers)</li>
</ol>
<h2 id="approach" tabindex="-1">Approach <a class="direct-link" href="#approach" aria-hidden="true">#</a></h2>
<h3 id="high-level-overview" tabindex="-1">High Level Overview <a class="direct-link" href="#high-level-overview" aria-hidden="true">#</a></h3>
<p>This approach (as hinted to above), will be using React Context.  This context will basically wrap the entire application, and thus, allow the &quot;page&quot; components to read from it.</p>
<p>Along with reading state from the context, the page components will then have the ability to dispatch actions to an application reducer, which of course, is responsible for taking an action and then computing a new state.</p>
<p>The flow chart below sums up the approach.</p>
<img class="post-2-flow-chart-img" src="https://bryans-blog.s3.amazonaws.com/State+Flow+-+Export.png"/>
<p>Above, the first shape (i.e. <code>App Component</code>) shows how the pages are contained within said element.</p>
<p>Next, starting from the <code>Page (Example: Home)</code> square, the flow chart walks us through what happens when the state needs to change.</p>
<p>To see a small project that implements this, please click <a href="https://github.com/bryg217/countries">here</a>.</p>
<h3 id="technical-design" tabindex="-1">Technical Design <a class="direct-link" href="#technical-design" aria-hidden="true">#</a></h3>
<p>There are going to be three files we care about for now:</p>
<ol>
<li>State File</li>
<li><code>App.js</code></li>
<li>Page Component</li>
</ol>
<h4 id="state-file" tabindex="-1">State File <a class="direct-link" href="#state-file" aria-hidden="true">#</a></h4>
<p>At a high level, this file contains all of the code associated to the API for managing state (i.e. Reducer, hooks for state and the provider).  Of course, it doesn't have to be this way for a production level app.  This is just all done within the same file for demonstrations purposes.</p>
<p>Below, I've included what this code might look like (e.g. <code>state.js</code>):</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> useReducer<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><br><br><span class="token keyword">const</span> AppStateContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> AppDispatchContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">case</span> <span class="token string">'SET_LOADED'</span><span class="token operator">:</span><br>      <span class="token keyword">const</span> <span class="token punctuation">{</span> loaded <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<br>      <span class="token keyword">return</span> <span class="token punctuation">{</span><br>        <span class="token operator">...</span>state<span class="token punctuation">,</span><br>        loaded<br>      <span class="token punctuation">}</span><br>    <span class="token keyword">default</span><span class="token operator">:</span><br>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unknown action: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span><br>  feed<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  loaded<span class="token operator">:</span> <span class="token boolean">false</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">AppProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>AppDispatchContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span>AppStateContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span><span class="token operator">></span><br>        <span class="token punctuation">{</span>children<span class="token punctuation">}</span><br>      <span class="token operator">&lt;</span><span class="token operator">/</span>AppStateContext<span class="token punctuation">.</span>Provider<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>AppDispatchContext<span class="token punctuation">.</span>Provider<span class="token operator">></span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">useContext</span><span class="token punctuation">(</span>AppStateContext<span class="token punctuation">)</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useAppDispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">useContext</span><span class="token punctuation">(</span>AppDispatchContext<span class="token punctuation">)</span></code></pre>
<p>Let's walk through the file.</p>
<p>The first part is we <code>import</code> all of our dependencies; that's pretty straight forward.</p>
<p>The next couple of lines are where we declare the two different contexts.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> AppStateContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> AppDispatchContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>As you can tell, there are two different contexts: One that contains the state and one that contains the dispatch function to be used for dispatching actions (separation of concerns).</p>
<p>The next thing that is done is the declaration of the <code>reducer</code>, a simple one albeit.  As you can see, it currently handles one type of action -- updating the loaded property of the state.  Again, simplicity used for demo purposes.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">case</span> <span class="token string">'SET_LOADED'</span><span class="token operator">:</span><br>      <span class="token keyword">const</span> <span class="token punctuation">{</span> loaded <span class="token punctuation">}</span> <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<br>      <span class="token keyword">return</span> <span class="token punctuation">{</span><br>        <span class="token operator">...</span>state<span class="token punctuation">,</span><br>        loaded<br>      <span class="token punctuation">}</span><br>    <span class="token keyword">default</span><span class="token operator">:</span><br>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Unknown action: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Next, we start to get into the exports.  The first export is the <code>AppProvider</code>:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// initial state above</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">AppProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>AppDispatchContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>dispatch<span class="token punctuation">}</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span>AppStateContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span><span class="token operator">></span><br>        <span class="token punctuation">{</span>children<span class="token punctuation">}</span><br>      <span class="token operator">&lt;</span><span class="token operator">/</span>AppStateContext<span class="token punctuation">.</span>Provider<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>AppDispatchContext<span class="token punctuation">.</span>Provider<span class="token operator">></span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<p>As you'll see, this is to be used in <code>App.js</code> to wrap the pages.  As a quick overview, this is used as a wrapper for declaring the reducer, initial state, and finally, passing said data to their respective providers.</p>
<p>Lastly, we export some hooks:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">useContext</span><span class="token punctuation">(</span>AppStateContext<span class="token punctuation">)</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useAppDispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">useContext</span><span class="token punctuation">(</span>AppDispatchContext<span class="token punctuation">)</span></code></pre>
<p>This is a pattern that helps avoid the following within a page component:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// without hooks - import</span><br><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><br><span class="token keyword">import</span> AppStateContext <span class="token keyword">from</span> <span class="token string">'./state'</span><br><br><span class="token comment">// without hooks - within component</span><br><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>AppStateContext<span class="token punctuation">)</span><br><br><span class="token comment">// with the hooks</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> useApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span><br><br><span class="token comment">// with the hooks - in component</span><br><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">useApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>And that pretty much sums up the &quot;state&quot; page.</p>
<p>Next, let's take a look at how we can begin to use it.</p>
<h4 id="app.js" tabindex="-1">App.js <a class="direct-link" href="#app.js" aria-hidden="true">#</a></h4>
<p>Now that everything is setup, <code>App.js</code> can look like:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Other imports</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> AppProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span><br><br><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// other code</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    <span class="token operator">&lt;</span>AppProvider<span class="token operator">></span><br>      <span class="token operator">&lt;</span>Home<span class="token operator">/</span><span class="token operator">></span><br>      <span class="token comment">// etc.</span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>AppProvider<span class="token operator">></span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Now, our components can hook into the state, as shown in the next section.</p>
<h4 id="page-component" tabindex="-1">Page Component <a class="direct-link" href="#page-component" aria-hidden="true">#</a></h4>
<pre class="language-js"><code class="language-js"><span class="token comment">// Other imports</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> useApp<span class="token punctuation">,</span> useAppDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span><br><br><span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// other code</span><br>  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useAppDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span> loaded <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      type<span class="token operator">:</span> <span class="token string">'SOME_TYPE'</span><span class="token punctuation">,</span><br>      payload<span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token comment">// some data</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    <span class="token operator">&lt;</span><span class="token operator">></span><br>      <span class="token operator">&lt;</span>span<span class="token operator">></span>Loaded<span class="token operator">:</span> <span class="token punctuation">{</span>loaded<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><br>      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onClick<span class="token punctuation">}</span><span class="token operator">></span>Click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>And there you go.  That is how we can <strong>read from</strong> and <strong>dispatch actions</strong> from a page component.</p>
<h2 id="conclusion" tabindex="-1">Conclusion <a class="direct-link" href="#conclusion" aria-hidden="true">#</a></h2>
<p>Well, that pretty much concludes this post.  Hope you got a lot of out it!</p>
<p>If you are interested in seeing a mini project that implements this, please checkout the project that was referenced above (<a href="https://github.com/bryg217/countries">here</a> is the link to avoid scrolling).</p>
<p>All the best!</p>

<hr>
<ul><li>Next: <a href="/posts/3-problem-solving/">3 Step Framework For Solving Almost All CS Problems</a></li><li>Previous: <a href="/posts/1-first-post/">Hello World</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/2-state/ -->
  </body>
</html>
